<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<div th:replace="header :: myHeader"></div>
</head>
<body class="sb-nav-fixed">
<div th:replace="navbar :: myNavbar"></div>
<div id="layoutSidenav">
	<div th:replace="sidebar :: mySidebar"></div>
	<!-- Sidebar ends here -->
	<div id="layoutSidenav_content">
		<main class="d-flex justify-content-center align-items-center" style="height: 100vh;">
			<div class="text-center">
				<!-- Make the paragraph large -->
				<p class="display-2">Smart Invoicing User Portal</p>
				<!-- Center the anchor tag below the paragraph -->
				<div th:if="${installed == null}">
					<div class="card small-card m-1 shadow-sm">
						<form id="initializeForm" th:action="@{/initialize-device}" method="POST">
							<div class="form-row p-2 align-items-center justify-content-center">
								<div class="col-sm-4 my-1">
									<label class="sr-only" for="tpin">TPIN</label>
									<input type="text" id="tpin" name="tpin" class="form-control" required minlength="10" maxlength="10" pattern="\d{10,10}" title="TPIN must be 10 digits." placeholder="Enter TPIN">
								</div>
								<div class="col-sm-3 my-1">
									<label class="sr-only" for="bhfId">Branch ID</label>
									<input type="text" id="bhfId" name="bhfId" class="form-control" required minlength="3" maxlength="3" pattern="\d{3,3}" title="BHF ID must be 3 digits." placeholder="Enter Branch ID">
								</div>
								<div class="col-sm-3 my-1">
									<label class="sr-only" for="dvcSrlNo">Device Serial Number</label>
									<input type="text" id="dvcSrlNo" name="dvcSrlNo" class="form-control" placeholder="Enter Device Serial Number">
								</div>
								<div class="col-auto my-1">
									<button type="submit" class="btn btn-primary">Initialize</button>
								</div>
							</div>
						</form>
					</div>
				</div>
				<div th:if="${installed != null}">
					The device is installed.
				</div>

			</div>
		</main>
		<footer class="py-4 bg-light mt-auto">
			<div class="container-fluid">
				<div class="d-flex align-items-center justify-content-between small">
					<div class="text-muted"></div>
					<div>
						<a href="#">Privacy Policy</a> &middot; <a href="#">Terms & Conditions</a>
					</div>
				</div>
			</div>
		</footer>
	</div>
</div>
<div class="modal fade" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="loadingModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document" >
		<div class="modal-content mx-auto">
			<div class="modal-body text-center">
				<div class="spinner-border" role="status">
					<span class="sr-only">Loading...</span>
				</div>
				<p class="mt-2" id="loadingMessage">Loading, please wait...</p>
			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function() {
		const form = document.getElementById("initializeForm");
		const responseMessage = document.getElementById("responseMessage");

		form.addEventListener("submit", function(e) {
			e.preventDefault(); // Prevent default form submission

			// Create an object from form data
			const formData = {
				tpin: form.tpin.value,
				bhfId: form.bhfId.value,
				dvcSrlNo: form.dvcSrlNo.value
			};

			fetch(form.action, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json' // Set content type to JSON
				},
				body: JSON.stringify(formData), // Convert object to JSON string
			})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok ' + response.statusText);
						}
						return response.text(); // Assuming the server responds with JSON
					})
					.then(html => {
						document.body.innerHTML = html;// Reset the form
					})
					.catch(error => {
						alert(error);
					});
		});
	});
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/scripts.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
<script src="js/datatables-demo.js"></script>

</body>
</html>
